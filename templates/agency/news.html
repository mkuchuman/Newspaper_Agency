{% extends "layouts/base.html" %}
{% block title %} News {% endblock %} 

{% block body_class %} sign-in-basic {% endblock %}

{% block content %}
  {% include 'includes/navigation.html' %} 
  <div class="page-header min-vh-80" style="background-image: url('https://images.unsplash.com/photo-1630752708689-02c8636b9141?ixlib=rb-1.2.1&ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&auto=format&fit=crop&w=2490&q=80')">
    <span class="mask bg-gradient-dark opacity-6"></span>
    <div class="container">
      <div class="row">
        <div class="col-md-8 mx-auto">
          <div class="text-center">
            <h1 class="text-white">News</h1>
          </div>
        </div>
      </div>
    </div>
  </div>
  <section class="py-7">
    <div class="container" style="max-height: 600px; overflow-y: auto;">
      <div class="text-center mt-4">
        <a href="{% url 'agency:newspaper-create' %}" class="btn btn-primary">Create New Newspaper</a>
      </div>
      <div class="row mt-6">
        {% for newspaper in page_obj %}
        <div class="col-lg-4 col-md-8">
          <div class="card card-plain">
            <div class="card-body">
              <div class="author">
                <div class="name">
                  <a href="{% url 'agency:news-detail' pk=newspaper.pk %}" style="text-decoration: underline; color: blue;">
                    <h6 class="mb-0 font-weight-bolder">{{ newspaper.title }}</h6>
                  </a>
                  <div class="stats">
                    <i class="far fa-clock"></i> {{ newspaper.published_date|timesince }} ago
                  </div>
                </div>
              </div>
              <p class="mt-4">{{ newspaper.content }}</p>
              <p><strong>Topics:</strong>
              {% for topic in newspaper.topics.all %}
                {{ topic.name }}{% if not forloop.last %}, {% endif %}
              {% endfor %}
              </p>
              <p><strong>Redactors:</strong>
              {% for redactor in newspaper.redactors.all %}
                {{ redactor.username }}{% if not forloop.last %}, {% endif %}
              {% endfor %}
              </p>
            </div>
          </div>
        </div>
        {% endfor %}
      </div>
    </div>
    <!-- Pagination -->
    <nav aria-label="Page navigation example">
      <ul class="pagination justify-content-center mt-4">
        {% if page_obj.has_previous %}
        <li class="page-item" style="margin: 0 10px;">
          <button class="page-link" type="button" onclick="loadPage('?page=1')">First</button>
        </li>
        <li class="page-item" style="margin: 0 10px;">
          <button class="page-link" type="button" onclick="loadPage('?page={{ page_obj.previous_page_number }}')">Previous</button>
        </li>
        {% endif %}
        {% for num in page_obj.paginator.page_range %}
          {% if page_obj.number == num %}
            <li class="page-item active" style="margin: 0 10px;"><span class="page-link">{{ num }}</span></li>
          {% else %}
            <li class="page-item" style="margin: 0 10px;"><button class="page-link" type="button" onclick="loadPage('?page={{ num }}')">{{ num }}</button></li>
          {% endif %}
        {% endfor %}
        {% if page_obj.has_next %}
        <li class="page-item" style="margin: 0 10px;">
          <button class="page-link" type="button" onclick="loadPage('?page={{ page_obj.next_page_number }}')">Next</button>
        </li>
        <li class="page-item" style="margin: 0 10px;">
          <button class="page-link" type="button" onclick="loadPage('?page={{ page_obj.paginator.num_pages }}')">Last</button>
        </li>
        {% endif %}
      </ul>
    </nav>
  </section>
{% endblock content %}

{% block javascripts %}
<script>
  function loadPage(url) {
    fetch(url)
      .then(response => {
        if (!response.ok) {
          throw new Error('Network response was not ok');
        }
        return response.text();
      })
      .then(data => {
        document.body.innerHTML = data;
      })
      .catch(error => console.error('Error:', error));
  }
</script>
{% endblock javascripts %}
